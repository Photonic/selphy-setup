<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Canon SELPHY Setup</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 0 20px; }
    h1 { font-size: 1.6em; }
    .result { padding: 10px; border-radius: 6px; margin-bottom: 10px; }
    .success { background: #e0ffe0; }
    .error { background: #ffe0e0; }
    #download { margin-top: 20px; display: none; }
  </style>
</head>
<body>
  <h1>ğŸ“¸ Canon SELPHY instellen</h1>

  <p>Voordat we je printerprofiel installeren, controleren we even het volgende:</p>

  <div id="ip" class="result">ğŸ”„ Jouw IP-adres wordt opgehaald...</div>
  <div id="printer" class="result">ğŸ”„ Printer wordt gecontroleerd...</div>
  <div id="internet" class="result">ğŸ”„ Internetverbinding wordt getest...</div>

  <a id="download" href="Canon_SELPHY_Multi_WiFi_Profile.mobileconfig" download>
    ğŸ“¥ Alles OK! Klik hier om het Canon-profiel te installeren
  </a>

  <script>
    // IP-adres ophalen via WebRTC-truc
    function getLocalIP(callback) {
      let ip = 'Onbekend';
      let pc = new RTCPeerConnection({iceServers:[]});
      pc.createDataChannel('');
      pc.createOffer().then(offer => pc.setLocalDescription(offer));
      pc.onicecandidate = (ice) => {
        if (!ice || !ice.candidate || !ice.candidate.candidate) return;
        let result = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(ice.candidate.candidate);
        if (result) {
          ip = result[1];
          callback(ip);
        }
        pc.close();
      };
    }

    function setStatus(id, ok, text) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = 'result ' + (ok ? 'success' : 'error');
    }

    function enableDownload() {
      document.getElementById('download').style.display = 'block';
    }

    getLocalIP(ip => {
      setStatus('ip', true, `âœ… Jouw IP-adres: ${ip}`);
    });

    fetch('http://192.168.0.1/', { mode: 'no-cors' })
      .then(() => setStatus('printer', true, 'âœ… Printer (192.168.0.1) is bereikbaar'))
      .catch(() => setStatus('printer', false, 'âŒ Printer niet bereikbaar (192.168.0.1)'));

    fetch('https://www.google.com/generate_204')
      .then(() => {
        setStatus('internet', true, 'âœ… Internetverbinding werkt');
        enableDownload();
      })
      .catch(() => setStatus('internet', false, 'âŒ Geen internetverbinding'));
  </script>
</body>
</html>