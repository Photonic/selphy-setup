<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Canon SELPHY Setup</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 0 20px; }
    h1 { font-size: 1.6em; }
    .result { padding: 10px; border-radius: 6px; margin-bottom: 10px; }
    .success { background: #e0ffe0; }
    .error { background: #ffe0e0; }
    #download { margin-top: 20px; display: none; }
  </style>
</head>
<body>
  <h1>📸 Canon SELPHY instellen</h1>

  <p>We controleren je netwerk en geven daarna toegang tot het printerprofiel:</p>

  <div id="ip" class="result">🔄 Jouw IP-adres wordt opgehaald...</div>
  <div id="printer" class="result success">
    ℹ️ Open de printerinterface handmatig: 
    <a href="http://192.168.0.1" target="_blank">http://192.168.0.1</a>
  </div>
  <div id="internet" class="result">🔄 Internetverbinding wordt getest...</div>

  <a id="download" href="Canon_SELPHY_Multi_WiFi_Profile.mobileconfig" download>
    📥 Alles OK! Klik hier om het Canon-profiel te installeren
  </a>

  <script>
    // IP-adres ophalen via WebRTC-truc (kan mislukken op iOS)
    function getLocalIP(callback) {
      let ip = 'Onbekend';
      let pc = new RTCPeerConnection({iceServers:[]});
      pc.createDataChannel('');
      pc.createOffer().then(offer => pc.setLocalDescription(offer));
      pc.onicecandidate = (ice) => {
        if (!ice || !ice.candidate || !ice.candidate.candidate) return;
        let result = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(ice.candidate.candidate);
        if (result) {
          ip = result[1];
          callback(ip);
        }
        pc.close();
      };
      setTimeout(() => callback("Niet beschikbaar"), 3000); // fallback
    }

    function setStatus(id, ok, text) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = 'result ' + (ok ? 'success' : 'error');
    }

    function enableDownload() {
      document.getElementById('download').style.display = 'block';
    }

    getLocalIP(ip => {
      if (ip === "Niet beschikbaar") {
        setStatus('ip', false, '⚠️ IP-adres kon niet worden opgehaald (iOS beperkt dit soms)');
      } else {
        setStatus('ip', true, `✅ Jouw IP-adres: ${ip}`);
      }
    });

    fetch('https://www.google.com/generate_204')
      .then(() => {
        setStatus('internet', true, '✅ Internetverbinding werkt');
        enableDownload();
      })
      .catch(() => setStatus('internet', false, '❌ Geen internetverbinding'));
  </script>
</body>
</html>
